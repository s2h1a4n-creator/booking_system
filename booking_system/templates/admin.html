<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>後台預約管理</title>

    <!-- 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
    --black: #111111;
    --gold:  #D5C79A;
    --gunmetal: #2B2B2B;
}

/********** 全域 **********/
body {
    background-color: var(--black);
    font-family: 'Noto Sans TC', sans-serif;
    color: white;
}

/********** 導覽列 **********/
.navbar {
    background-color: var(--black);
    border-bottom: 1px solid var(--gold);
}
.navbar-brand span {
    color: var(--gold);
    font-weight: 700;
}

/********** 卡片 **********/
.card {
    background-color: var(--gunmetal);
    border: 1px solid #3A3A3A;
    color: white;
    border-radius: 16px;
}

.section-title {
    font-weight: 700;
    border-left: 6px solid var(--gold);
    padding-left: 10px;
    color: var(--gold);
}

/********** 深色下拉 + 輸入框 **********/
.form-select,
.form-control {
    background-color: #1A1A1A !important;
    color: white !important;
    border: 1.5px solid var(--gold) !important;
    border-radius: 8px;
    padding-right: 2rem !important;
}

.form-select:focus,
.form-control:focus {
    border-color: var(--gold) !important;
    box-shadow: 0 0 10px rgba(213,199,154,0.55) !important;
    background-color: #222 !important;
}

::placeholder {
    color: #cccccc !important;
}

/********** ▼ 下拉箭頭（金色） **********/
.form-select {
    background-image:
        url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23D5C79A' viewBox='0 0 16 16'%3e%3cpath d='M3.2 5.2a.5.5 0 0 1 .6-.05L8 7.3l4.2-2.15a.5.5 0 0 1 .58.82l-4.5 2.3a.5.5 0 0 1-.46 0l-4.5-2.3a.5.5 0 0 1-.12-.75z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right .8rem center;
    background-size: 18px 18px;
}

/********** 日期 icon 金色 **********/
input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(88%) sepia(12%) saturate(250%) hue-rotate(10deg) brightness(130%);
    opacity: 1;
    cursor: pointer;
}
input[type="date"]::-webkit-calendar-picker-indicator:hover {
    filter: invert(100%) sepia(20%) saturate(300%) brightness(150%);
}

/********** 表格 **********/
table {
    color: white !important;
}
thead {
    background-color: #222;
    color: var(--gold);
    border-bottom: 2px solid var(--gold);
}
tbody tr {
    background-color: #1A1A1A !important;
    border-bottom: 1px solid #333;
}
tbody tr:hover {
    background-color: #262626 !important;
}

/********** 按鈕 **********/
.btn-gold {
    background-color: var(--gold);
    color: black;
    font-weight: 600;
    border: none;
}
.btn-gold:hover {
    background-color: #c7ba8c;
}

.btn-danger {
    background-color: #B33A3A !important;
    border: none;
}
.btn-danger:hover {
    background-color: #992f2f !important;
}

</style>
</head>

<body>

<!-- 導覽列 -->
<nav class="navbar navbar-dark shadow-sm px-4">
    <a class="navbar-brand" href="/">
        <span>後台管理系統</span>
    </a>
</nav>

<div class="container py-5">

    <h2 class="text-center mb-4" style="color: var(--gold);">預約管理</h2>

    <div class="text-center mb-3">
        <a href="/" class="btn btn-gold">返回前台</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category=='error' else 'success' }}">
            {{ message }}
        </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- 搜尋區 -->
    <div class="card shadow mb-4">
        <div class="card-body">

            <h5 class="section-title mb-3">搜尋與篩選</h5>

            <form method="GET" action="/admin" class="row g-3">

                <div class="col-md-3">
                    <label class="form-label">教練</label>
                    <select name="coach" class="form-select">
                        <option value="all">全部</option>
                        {% for name in coach_names %}
                        <option value="{{ name }}" {% if coach_filter == name %}selected{% endif %}>
                            {{ name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">課程類別</label>
                    <select name="course_type" class="form-select">
                        <option value="all">全部</option>
                        {% for ct in course_types %}
                        <option value="{{ ct }}" {% if course_filter == ct %}selected{% endif %}>
                            {{ ct }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">日期</label>
                    <input type="date" class="form-control" name="date" value="{{ date_filter }}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">姓名搜尋</label>
                    <input type="text" name="client_name" class="form-control"
                           value="{{ name_filter }}" placeholder="輸入姓名關鍵字">
                </div>

                <div class="col-12">
                    <button class="btn btn-gold w-100">搜尋</button>
                </div>

            </form>
        </div>
    </div>

    <!-- 預約資料表 -->
    <div class="card shadow">
        <div class="card-body">

            {% if bookings %}
            <div class="table-responsive">
                <table class="table table-bordered align-middle">

                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>姓名</th>
                            <th>電話</th>
                            <th>Email</th>
                            <th>性別</th>
                            <th>生日</th>
                            <th>Line ID</th>
                            <th>課程類別</th>
                            <th>教練</th>
                            <th>日期</th>
                            <th>時間</th>
                            <th>備註</th>
                            <th>操作</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for b in bookings %}
                        <tr>
                            <td>{{ b.id }}</td>
                            <td>{{ b.client_name }}</td>
                            <td>{{ b.phone }}</td>
                            <td>{{ b.email }}</td>
                            <td>{{ b.gender }}</td>
                            <td>{{ b.birthday }}</td>
                            <td>{{ b.line_id }}</td>
                            <td>{{ b.course_type }}</td>
                            <td>{{ b.coach }}</td>
                            <td>{{ b.date }}</td>
                            <td>{{ b.time }}</td>
                            <td>{{ b.note }}</td>

                            <td>
                                <form action="/admin/delete/{{ b.id }}" method="POST"
                                      onsubmit="return confirm('確定要刪除這筆預約嗎？');">
                                    <button class="btn btn-danger btn-sm">刪除</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>

            {% else %}
            <p class="text-center" style="color: #bbb;">沒有符合條件的預約。</p>
            {% endif %}

        </div>
    </div>

</div>

</body>
</html>
